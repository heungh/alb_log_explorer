# ALB Ïï°ÏÑ∏Ïä§ Î°úÍ∑∏ Î∂ÑÏÑù ÌûàÏä§ÌÜ†Î¶¨

## üìä ALB Ïï°ÏÑ∏Ïä§ Î°úÍ∑∏ ÏÑ§Ï†ï Î∞è Î∂ÑÏÑù Í≤∞Í≥º

### üîß ÏÑ§Ï†ï Ï†ïÎ≥¥
- **Î∂ÑÏÑù ÏùºÏãú:** 2025-08-31 07:03-07:11 UTC
- **ALB Ïù¥Î¶Ñ:** alb-match
- **ALB ARN:** arn:aws:elasticloadbalancing:ap-northeast-2:181136804328:loadbalancer/app/alb-match/f895263fb0246bf5
- **Î°úÍ∑∏ Î≤ÑÌÇ∑:** alb-access-logs-20250819
- **Î°úÍ∑∏ ÌîÑÎ¶¨ÌîΩÏä§:** alb-match

### üìÅ Î°úÍ∑∏ ÌååÏùº Ï†ïÎ≥¥
- **ÌååÏùºÎ™Ö:** 181136804328_elasticloadbalancing_ap-northeast-2_app.alb-match.f895263fb0246bf5_20250831T0705Z_15.165.114.31_kkuwr68o.log.gz
- **ÌååÏùº ÌÅ¨Í∏∞:** 405 bytes
- **Î°úÍ∑∏ ÏóîÌä∏Î¶¨ Ïàò:** 1Í∞ú

### üéØ Î∞úÍ≤¨Îêú ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏöîÏ≤≠ Ï†ïÎ≥¥

#### üìä ÏöîÏ≤≠ ÏÉÅÏÑ∏ Î∂ÑÏÑù
- **üïê ÏöîÏ≤≠ ÏãúÍ∞Ñ:** 2025-08-31T07:03:31.828037Z
- **üîó ÌîÑÎ°úÌÜ†ÏΩú:** HTTPS
- **üñ•Ô∏è ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ IP:** 15.235.227.163:44410
- **üéØ ÌÉÄÍ≤ü:** - (Ïó∞Í≤∞ Ïã§Ìå®)
- **üìà ÏÉÅÌÉúÏΩîÎìú:** 503 (Service Unavailable)
- **üìä Î∞îÏù¥Ìä∏:** ÏàòÏã†=151, ÏÜ°Ïã†=337

#### üåê HTTP ÏöîÏ≤≠ Ï†ïÎ≥¥
- **üåç HTTP Î©îÏÜåÎìú:** GET
- **üõ§Ô∏è ÏöîÏ≤≠ Í≤ΩÎ°ú:** `/` (Î£®Ìä∏ Í≤ΩÎ°ú)
- **üìã HTTP Î≤ÑÏ†Ñ:** HTTP/1.1
- **üîó Ï†ÑÏ≤¥ URL:** https://15.165.114.31:443/

#### ü§ñ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï†ïÎ≥¥
- **User-Agent:** Mozilla/5.0 (compatible; ModatScanner/1.1; +https://modat.io/)
- **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ïú†Ìòï:** Î≥¥Ïïà Ïä§Ï∫êÎÑà Î¥á (ModatScanner)

#### üîê Î≥¥Ïïà Ï†ïÎ≥¥
- **TLS Î≤ÑÏ†Ñ:** TLSv1.3
- **ÏïîÌò∏Ìôî Î∞©Ïãù:** TLS_AES_128_GCM_SHA256
- **Ïù∏Ï¶ùÏÑú ARN:** arn:aws:acm:ap-northeast-2:181136804328:certificate/0d41432d-dde6-4ce5-a835-e0652b38f992

### üìà ÏöîÏïΩ ÌÜµÍ≥Ñ

#### ÏöîÏ≤≠ Í≤ΩÎ°úÎ≥Ñ Ï†ëÍ∑º ÌöüÏàò
| ÌöüÏàò | Í≤ΩÎ°ú | Î©îÏÜåÎìú | ÏÉÅÌÉúÏΩîÎìú |
|------|------|--------|----------|
| 1Ìöå  | `/`  | GET    | 503      |

### üîç Î∂ÑÏÑù Í≤∞Í≥º

1. **ÏöîÏ≤≠ Ìå®ÌÑ¥**: ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Í∞Ä ALBÏùò **Î£®Ìä∏ Í≤ΩÎ°ú (`/`)**Ïóê HTTPSÎ°ú Ï†ëÍ∑º
2. **Ïó∞Í≤∞ ÏÉÅÌÉú**: 503 Ïò§Î•òÎ°ú Î∞±ÏóîÎìú ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå®
3. **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ïú†Ìòï**: ÏûêÎèôÌôîÎêú Î≥¥Ïïà Í≤ÄÏÇ¨ ÎèÑÍµ¨ (ModatScanner)
4. **Î≥¥Ïïà**: TLSv1.3ÏùÑ ÏÇ¨Ïö©Ìïú ÏïàÏ†ÑÌïú ÏïîÌò∏Ìôî Ïó∞Í≤∞ ÏãúÎèÑ

### üõ†Ô∏è ÏÇ¨Ïö©Îêú Î∂ÑÏÑù Î™ÖÎ†πÏñ¥

#### ALB Î°úÍ∑∏ ÌôúÏÑ±Ìôî
```bash
aws elbv2 modify-load-balancer-attributes \
    --load-balancer-arn arn:aws:elasticloadbalancing:ap-northeast-2:181136804328:loadbalancer/app/alb-match/f895263fb0246bf5 \
    --attributes \
        Key=access_logs.s3.enabled,Value=true \
        Key=access_logs.s3.bucket,Value=alb-access-logs-20250819 \
        Key=access_logs.s3.prefix,Value=alb-match \
    --region ap-northeast-2
```

#### Î°úÍ∑∏ ÌååÏùº Î∂ÑÏÑù
```bash
# Î°úÍ∑∏ ÌååÏùº Îã§Ïö¥Î°úÎìú
aws s3 cp s3://alb-access-logs-20250819/alb-match/AWSLogs/181136804328/elasticloadbalancing/ap-northeast-2/2025/08/31/ . --recursive

# ÏïïÏ∂ï Ìï¥Ï†ú Î∞è Î∂ÑÏÑù
gunzip *.gz
cat *.log

# ÏöîÏ≤≠ Í≤ΩÎ°ú Ï∂îÏ∂ú
awk '{match($0, /"[A-Z]+ ([^ ]+) HTTP/); if(RSTART) print substr($0, RSTART, RLENGTH)}' *.log
```

### üìã Î°úÍ∑∏ ÌïÑÎìú Íµ¨Ï°∞

ALB Ïï°ÏÑ∏Ïä§ Î°úÍ∑∏Ïùò Ï£ºÏöî ÌïÑÎìú:
1. type (https)
2. timestamp (2025-08-31T07:03:31.828037Z)
3. elb (app/alb-match/f895263fb0246bf5)
4. client:port (15.235.227.163:44410)
5. target:port (-)
6. request_processing_time (-1)
7. target_processing_time (-1)
8. response_processing_time (-1)
9. elb_status_code (503)
10. target_status_code (-)
11. received_bytes (151)
12. sent_bytes (337)
13. request ("GET https://15.165.114.31:443/ HTTP/1.1")
14. user_agent ("Mozilla/5.0 (compatible; ModatScanner/1.1; +https://modat.io/)")
15. ssl_cipher (TLS_AES_128_GCM_SHA256)
16. ssl_protocol (TLSv1.3)

### üí° Ìñ•ÌõÑ Î∂ÑÏÑù Î∞©Ìñ•

1. **Ìä∏ÎûòÌîΩ Ï¶ùÍ∞Ä Ïãú**: Îçî Îã§ÏñëÌïú Í≤ΩÎ°ú Ìå®ÌÑ¥ Î∂ÑÏÑù Í∞ÄÎä•
2. **Athena ÌôúÏö©**: ÎåÄÏö©Îüâ Î°úÍ∑∏ Îç∞Ïù¥ÌÑ∞ SQL ÏøºÎ¶¨ Î∂ÑÏÑù
3. **CloudWatch Insights**: Ïã§ÏãúÍ∞Ñ Î°úÍ∑∏ Î™®ÎãàÌÑ∞ÎßÅ Î∞è ÏïåÎûå ÏÑ§Ï†ï
4. **Î≥¥Ïïà Î∂ÑÏÑù**: ÎπÑÏ†ïÏÉÅÏ†ÅÏù∏ Ï†ëÍ∑º Ìå®ÌÑ¥ ÌÉêÏßÄ

## üîç ALB Í≤ΩÎ°ú Íµ¨Î∂Ñ Îä•Î†• ÏÉÅÏÑ∏ Î∂ÑÏÑù

### ‚úÖ ALBÍ∞Ä Ï†ïÌôïÌûà Íµ¨Î∂ÑÌï† Ïàò ÏûàÎäî Í≤ÉÎì§:

#### 1. Í∏∞Î≥∏ Í≤ΩÎ°ú Íµ¨Î∂Ñ
- `/`, `/home`, `/about` Îì± Î™®Îì† Í≤ΩÎ°ú Î†àÎ≤®
- `/api/v1/users`, `/api/v1/users/123`, `/api/v1/users/123/profile`

#### 2. HTTP Î©îÏÜåÎìúÎ≥Ñ Íµ¨Î∂Ñ
```
"GET /api/users HTTP/1.1"
"POST /api/users HTTP/1.1"  
"PUT /api/users/123 HTTP/1.1"
"DELETE /api/users/123 HTTP/1.1"
```

#### 3. ÏøºÎ¶¨ ÌååÎùºÎØ∏ÌÑ∞ ÏôÑÏ†Ñ Ìè¨Ìï®
```
"GET /search?q=aws&category=cloud&page=1 HTTP/1.1"
"GET /products?page=2&limit=20&sort=price HTTP/1.1"
"GET /api/users?filter=active&role=admin HTTP/1.1"
```

#### 4. Ï†ïÏ†Å Î¶¨ÏÜåÏä§
```
"GET /images/logo.png HTTP/1.1"
"GET /css/bootstrap.min.css HTTP/1.1"
"GET /js/app.js HTTP/1.1"
"GET /favicon.ico HTTP/1.1"
```

#### 5. ÌäπÏàò Î¨∏Ïûê Î∞è Ïù∏ÏΩîÎî©
```
"GET /path/with%20spaces HTTP/1.1"
"GET /korean/ÌïúÍ∏ÄÍ≤ΩÎ°ú HTTP/1.1"
"GET /special/path-with_underscore HTTP/1.1"
```

### üìä Í≤ΩÎ°ú Î∂ÑÏÑù ÏòàÏãú Í≤∞Í≥º

#### Î™®Îì† ÏöîÏ≤≠ Í≤ΩÎ°ú Î™©Î°ù:
| Î©îÏÜåÎìú | Í≤ΩÎ°ú |
|--------|------|
| GET | / |
| GET | /api/users |
| GET | /api/users/123 |
| POST | /api/users/123/profile |
| GET | /images/logo.png |
| GET | /search?q=aws&category=cloud&page=1 |
| GET | /nonexistent/path |

#### HTTP Î©îÏÜåÎìúÎ≥Ñ Î∂ÑÎ•ò:
- **GET**: 6Ìöå
- **POST**: 1Ìöå

#### API Í≤ΩÎ°úÎßå ÌïÑÌÑ∞ÎßÅ:
- GET /api/users
- GET /api/users/123  
- POST /api/users/123/profile

## üñ•Ô∏è AWS Ïõπ ÏΩòÏÜîÏóêÏÑú ALB Î°úÍ∑∏ ÌôïÏù∏ Î∞©Î≤ï

### 1. üìä Athena Console (Í∞ÄÏû• Í∞ïÎ†•Ìïú Î∞©Î≤ï)

#### ALB Î°úÍ∑∏ ÌÖåÏù¥Î∏î ÏÉùÏÑ± SQL:
```sql
CREATE EXTERNAL TABLE alb_access_logs (
    type string,
    time string,
    elb string,
    client_ip string,
    client_port int,
    target_ip string,
    target_port int,
    request_processing_time double,
    target_processing_time double,
    response_processing_time double,
    elb_status_code int,
    target_status_code string,
    received_bytes bigint,
    sent_bytes bigint,
    request string,
    user_agent string,
    ssl_cipher string,
    ssl_protocol string,
    target_group_arn string,
    trace_id string,
    domain_name string,
    chosen_cert_arn string,
    matched_rule_priority int,
    request_creation_time string,
    actions_executed string,
    redirect_url string,
    lambda_error_reason string,
    target_port_list string,
    target_status_code_list string,
    classification string,
    classification_reason string
)
PARTITIONED BY(
    year string,
    month string,
    day string
)
STORED AS INPUTFORMAT 
    'org.apache.hadoop.mapred.TextInputFormat' 
OUTPUTFORMAT 
    'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'
LOCATION 's3://alb-access-logs-20250819/alb-match/AWSLogs/181136804328/elasticloadbalancing/ap-northeast-2/'
TBLPROPERTIES (
    'projection.enabled'='true',
    'projection.year.type'='integer',
    'projection.year.range'='2020,2030',
    'projection.month.type'='integer',
    'projection.month.range'='1,12',
    'projection.month.digits'='2',
    'projection.day.type'='integer',
    'projection.day.range'='1,31',
    'projection.day.digits'='2',
    'storage.location.template'='s3://alb-access-logs-20250819/alb-match/AWSLogs/181136804328/elasticloadbalancing/ap-northeast-2/${year}/${month}/${day}/'
);
```

#### ÏöîÏ≤≠ Í≤ΩÎ°úÎ≥Ñ Î∂ÑÏÑù ÏøºÎ¶¨:
```sql
SELECT 
    regexp_extract(request, '^(\w+)\s+([^\s]+)\s+', 2) as request_path,
    regexp_extract(request, '^(\w+)\s+', 1) as method,
    COUNT(*) as request_count,
    AVG(target_processing_time) as avg_response_time,
    elb_status_code
FROM alb_access_logs 
WHERE year='2025' AND month='08' AND day='31'
GROUP BY 
    regexp_extract(request, '^(\w+)\s+([^\s]+)\s+', 2),
    regexp_extract(request, '^(\w+)\s+', 1),
    elb_status_code
ORDER BY request_count DESC
LIMIT 20;
```

### 2. üìà CloudWatch Logs Insights

#### Ï†ëÍ∑º Î∞©Î≤ï:
1. **AWS Console ‚Üí CloudWatch ‚Üí Logs ‚Üí Insights**
2. Î°úÍ∑∏ Í∑∏Î£π ÏÑ†ÌÉù: `/aws/applicationloadbalancer/alb-match`

#### ÏøºÎ¶¨ ÏòàÏãú:
```sql
fields @timestamp, request
| filter request like /GET/
| stats count() by request
| sort count desc
| limit 20
```

```sql
fields @timestamp, request, elb_status_code
| filter elb_status_code >= 400
| stats count() by request
| sort count desc
```

### 3. üóÇÔ∏è S3 Console

#### Ï†ëÍ∑º Í≤ΩÎ°ú:
1. **AWS Console ‚Üí S3 ‚Üí alb-access-logs-20250819**
2. **alb-match/AWSLogs/181136804328/elasticloadbalancing/ap-northeast-2/**
3. Î°úÍ∑∏ ÌååÏùº Îã§Ïö¥Î°úÎìú ÌõÑ Î°úÏª¨ÏóêÏÑú Î∂ÑÏÑù

### 4. üìä CloudWatch Dashboard

#### ÏÉùÏÑ±Îêú ÎåÄÏãúÎ≥¥Îìú:
- **ÎåÄÏãúÎ≥¥ÎìúÎ™Ö**: ALB-Access-Logs-Dashboard
- **ÏúÑÏπò**: AWS Console ‚Üí CloudWatch ‚Üí Dashboards

#### ÎåÄÏãúÎ≥¥Îìú ÏøºÎ¶¨:
```sql
SOURCE '/aws/applicationloadbalancer/alb-match'
| fields @timestamp, request
| filter request like /GET/
| stats count() by bin(5m)
```

### üéØ Ïõπ ÏΩòÏÜî Ï†ëÍ∑º Î∞©Î≤ï ÏöîÏïΩ

#### ‚úÖ Ï¶âÏãú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î∞©Î≤ïÎì§:

1. **Athena** (Í∞ÄÏû• Í∞ïÎ†•)
   - SQL ÏøºÎ¶¨Î°ú ÏÉÅÏÑ∏ Î∂ÑÏÑù
   - Í≤ΩÎ°úÎ≥Ñ ÌÜµÍ≥Ñ, ÏùëÎãµÏãúÍ∞Ñ, Ïò§Î•òÏú® Î∂ÑÏÑù

2. **CloudWatch Logs Insights**
   - Ïã§ÏãúÍ∞Ñ Î°úÍ∑∏ Í≤ÄÏÉâ/Î∂ÑÏÑù
   - ÌïÑÌÑ∞ÎßÅ Î∞è ÏßëÍ≥Ñ Í∏∞Îä•

3. **CloudWatch Dashboard**
   - ÏãúÍ∞ÅÏ†Å ÎåÄÏãúÎ≥¥Îìú
   - Ïã§ÏãúÍ∞Ñ Î™®ÎãàÌÑ∞ÎßÅ

4. **S3 Console**
   - ÏõêÎ≥∏ ÌååÏùº Îã§Ïö¥Î°úÎìú
   - ÏàòÎèô Î∂ÑÏÑù

#### üöÄ Í∂åÏû• ÏÇ¨Ïö©Î≤ï:
- **ÏùºÌöåÏÑ± Î∂ÑÏÑù**: Athena Console
- **Ïã§ÏãúÍ∞Ñ Î™®ÎãàÌÑ∞ÎßÅ**: CloudWatch Logs Insights
- **ÏßÄÏÜçÏ†Å Î™®ÎãàÌÑ∞ÎßÅ**: CloudWatch Dashboard

### üí° Ï∂îÍ∞Ä Î∂ÑÏÑù ÏøºÎ¶¨ ÏòàÏãú

#### Í∞ÄÏû• ÎßéÏù¥ Ï†ëÍ∑ºÎêòÎäî Í≤ΩÎ°ú TOP 10:
```sql
SELECT 
    regexp_extract(request, '^[A-Z]+\s+([^\s\?]+)', 1) as path,
    COUNT(*) as count
FROM alb_access_logs 
WHERE year='2025' AND month='08' AND day='31'
GROUP BY regexp_extract(request, '^[A-Z]+\s+([^\s\?]+)', 1)
ORDER BY count DESC
LIMIT 10;
```

#### 404 Ïò§Î•òÍ∞Ä Î∞úÏÉùÌïú Í≤ΩÎ°úÎì§:
```sql
SELECT 
    regexp_extract(request, '^[A-Z]+\s+([^\s]+)', 1) as path,
    COUNT(*) as error_count
FROM alb_access_logs 
WHERE elb_status_code = 404
    AND year='2025' AND month='08' AND day='31'
GROUP BY regexp_extract(request, '^[A-Z]+\s+([^\s]+)', 1)
ORDER BY error_count DESC;
```

#### ÏùëÎãµ ÏãúÍ∞ÑÏù¥ Í∏¥ Í≤ΩÎ°ú Î∂ÑÏÑù:
```sql
SELECT 
    regexp_extract(request, '^[A-Z]+\s+([^\s\?]+)', 1) as path,
    AVG(target_processing_time) as avg_response_time,
    MAX(target_processing_time) as max_response_time,
    COUNT(*) as request_count
FROM alb_access_logs 
WHERE target_processing_time > 0
    AND year='2025' AND month='08' AND day='31'
GROUP BY regexp_extract(request, '^[A-Z]+\s+([^\s\?]+)', 1)
ORDER BY avg_response_time DESC
LIMIT 10;
```

---
*Î∂ÑÏÑù ÏôÑÎ£å: 2025-08-31 07:13 UTC*
